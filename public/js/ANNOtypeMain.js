jQuery(document).ready(function(c){c("abbr.timeago").timeago();c("a.whatIsThis").fancybox({titleShow:false,padding:0,showCloseButton:false,width:540,height:480,autoScale:false,autoDimensions:false,scrolling:"no"});bHide="";c(".ANNOtype_bubble input[name=status]").each(function(){if(c(this).attr("value")=="pending"){var d=c(this).parents(".ANNOtype_bubble").attr("id");var e=d.replace("ANNOtype_bubble_","");c(".the-content #annotationID_"+e).removeClass("annotation")}});if(c.cookie("optin")=="true"){c(".subscribeupdates").hide();c("input[name=subscribecheck]").removeAttr("checked")}c(".the-content .annotation").each(function(){c(this).append('<span class="smallBubble"></span>')});if((typeof(FB)=="object"&&FB._userStatus=="unknown")||c(".ANNOtype_twitter").length==0){if(c.cookie("anno_name")){c(".ANNOtype_bubble input[name=name], .annoboxform input[name=name]").attr("value",c.cookie("anno_name"))}if(c.cookie("anno_email")){c(".ANNOtype_bubble input[name=email], .annoboxform input[name=emal]").attr("value",c.cookie("anno_email"))}if(c.cookie("anno_website")){c(".ANNOtype_bubble input[name=website], .annoboxform input[name=website]").attr("value",c.cookie("anno_website"))}}c("#bottom_ANNOWidget").hover(function(){c(this).children(".ANNOWidgetDesc").slideDown("fast")},function(){c(this).children(".ANNOWidgetDesc").slideUp("fast")});c("#side_ANNOWidget").hover(function(){c(".ANNOWidgetDesc").show("slide",{direction:"left"},150)},function(){c(".ANNOWidgetDesc").hide("slide",{direction:"left"},150)});c(".annotation").mouseleave(function(){c(".ANNOBubbleCount").stop(false,true).fadeOut()});c(".ANNOBubbleCount").mouseenter(function(){c(this).stop(false,true).fadeIn(0)});c(".annotation").mouseover(function(){if(ANNOVars.bubbleCount=="On"){c(".newANNODiscuss, .newANNODiscussImg, .ANNOBubbleCount").hide();var g=c(this).find(".smallBubble").offset();var d=c(this).width();var f=c(this).attr("id");var h=f.replace("annotationID_","");c("#ANNOtype_bubble_count_"+h).css("position","absolute");c("#ANNOtype_bubble_count_"+h).css("left",g.left);c("#ANNOtype_bubble_count_"+h).css("top",g.top-8);c("#ANNOtype_bubble_count_"+h).fadeIn(150)}else{c(".newANNODiscuss, .newANNODiscussImg").hide();clearTimeout(bHide);var g=c(this).find(".smallBubble").offset();var d=c(this).width();c(".newANNOComment").css("position","absolute");c(".newANNOComment").css("left",g.left+6);c(".newANNOComment").css("top",g.top+10);c(".newANNOComment").attr("id",c(this).attr("id"));var f=c(this).attr("id");var h=f.replace("annotationID_","");var e=c("#ANNOtype_bubble_"+h).find(".ANNOresponses li").length;c(".newANNOComment").find(".count").text(e);c(".newANNOComment").fadeIn(150)}});c(".ANNOBubbleCount").click(function(h){h.preventDefault();var f=c(this).attr("id");var j=f.replace("ANNOtype_bubble_count_","");var g=c("#annotationID_"+j).find(".smallBubble").offset();var d=c("#annotationID_"+j).width();c(".ANNOtype_bubble").fadeOut();if(!c("#ANNOtype_bubble_"+j).is(":visible")){c("#ANNOtype_bubble_"+j).css("position","absolute");c("#ANNOtype_bubble_"+j).css("left",g.left-8);c("#ANNOtype_bubble_"+j).css("top",g.top+35);c("#ANNOtype_bubble_"+j).fadeIn(150);if(c("#ANNOtype_bubble_"+j).find(".ANNOresponses ul").height()>250){c("#ANNOtype_bubble_"+j).find(".ANNOresponses").css("overflow-y","scroll").addClass("ANNOresponsesFrame");c("#ANNOtype_bubble_"+j).find(".ANNOresponses li, .ANNOresponseTitle, .ANNOresponseComment, .ANNOresponseMeta").addClass("ANNOresponseShort")}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_bubbleHitCount"},function(e){})}});c(".newANNOComment .converseOnly, .newANNOComment .converse").click(function(){var h=c(this).parents(".newANNOComment").attr("id");c(this).parents(".newANNOComment").fadeOut(150);c(".newANNODiscuss, .newANNODiscussImg").hide();var f=c("#"+h).find(".smallBubble").offset();var e=c("#"+h).attr("ID");var g=e.replace("annotationID_","");var d=c("#"+h).width();if(!c("#ANNOtype_bubble_"+g).is(":visible")){c("#ANNOtype_bubble_"+g).css("position","absolute");c("#ANNOtype_bubble_"+g).css("left",f.left-8);c("#ANNOtype_bubble_"+g).css("top",f.top+35);c("#ANNOtype_bubble_"+g).fadeIn(150);if(c("#ANNOtype_bubble_"+g).find(".ANNOresponses ul").height()>250){c("#ANNOtype_bubble_"+g).find(".ANNOresponses").css("overflow-y","scroll").addClass("ANNOresponsesFrame");c("#ANNOtype_bubble_"+g).find(".ANNOresponses li, .ANNOresponseTitle, .ANNOresponseComment, .ANNOresponseMeta").addClass("ANNOresponseShort")}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_bubbleHitCount"},function(j){})}return false});c(".annotation").click(function(h){var k=c(this).attr("id");c(".newANNODiscuss, .newANNOComment").hide();var g=c("#"+k).find(".smallBubble").offset();var f=c("#"+k).attr("ID");var j=f.replace("annotationID_","");var d=c("#"+k).width();if(!c("#ANNOtype_bubble_"+j).is(":visible")){c("#ANNOtype_bubble_"+j).css("position","absolute");c("#ANNOtype_bubble_"+j).css("left",g.left-8);c("#ANNOtype_bubble_"+j).css("top",g.top+35);c("#ANNOtype_bubble_"+j).fadeIn(150);if(c("#ANNOtype_bubble_"+j).find(".ANNOresponses ul").height()>250){c("#ANNOtype_bubble_"+j).find(".ANNOresponses").css("overflow-y","scroll").addClass("ANNOresponsesFrame");c("#ANNOtype_bubble_"+j).find(".ANNOresponses li, .ANNOresponseTitle, .ANNOresponseComment, .ANNOresponseMeta").addClass("ANNOresponseShort")}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_bubbleHitCount"},function(e){})}});c(".ANNOtype_bubble").mouseover(function(){clearTimeout(bHide)});c(".respondAnnotation").live("click",function(){c(this).fadeOut(150);c(".respondForm").fadeIn(150);clearTimeout(bHide);return false});c(".commentAnnotation").live("click",function(){var f=c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=annotationID]").val();var e=c(this).parents(".ANNOtype_bubble");if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=userID]").length==0){if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()==""||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()=="Name (required)"){alert("Your name is required.");c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").addClass("error").focus();return false}else{c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").removeClass("error")}if((c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()==""||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()=="Email (required, private)")&&c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=emailRequired]").val()=="On"){alert("Your email is required.");c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").addClass("error").focus();return false}else{c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").removeClass("error")}}if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val()=="What is on your mind?"||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val()==""){alert("Please enter a comment");c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").addClass("error").focus();return false}else{c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").removeClass("error").focus()}if((typeof(FB)=="object"&&FB._userStatus=="unknown")||c(".ANNOtype_twitter").length==0){c.cookie("anno_name",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val());c.cookie("anno_email",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val());c.cookie("anno_website",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=website]").val());c(".ANNOtype_bubble input[name=name]").attr("value",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val());c(".ANNOtype_bubble input[name=email]").attr("value",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val());c(".ANNOtype_bubble input[name=website]").attr("value",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=website]").val())}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_addPostComment",ID:f,name:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val(),email:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val(),website:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=website]").val(),comment:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val(),userID:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=userID]").val(),subscribe:c(this).parents(".ANNOtype_bubble").find("input[name=subscribecheck]").is(":checked")},function(g){if(g!=="spam"){c(e).find(".ANNOresponses ul").append(g);c("abbr.timeago").timeago();c(e).find(".ANNOresponses").fadeIn(150);if(c(e).find(".ANNOresponses ul").height()>250){c(e).find(".ANNOresponses").css("overflow-y","scroll").addClass("ANNOresponsesFrame");c(e).find(".ANNOresponses li, .ANNOresponseTitle, .ANNOresponseComment, .ANNOresponseMeta").addClass("ANNOresponseShort")}c.cookie("optin",true,{expires:30})}else{alert("Your comment has been marked as spam.")}c(e).find(".ANNOtype_bubbleRespond textarea").val("What is on your mind?")});if(ANNOVars.collector=="Aweber"&&c(this).parents(".ANNOtype_bubble").find("input[name=subscribecheck]").is(":checked")&&ANNOVars.aweber=="On"&&trim(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()).length>=1&&trim(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()).length>=1){c.post("http://www.aweber.com/scripts/addlead.pl",{listname:ANNOVars.aweberListName,name:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val(),email:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()})}var d=c(e).position();c(e).fadeOut(150);c("#ANNOtype_bubble_moderation").css("position","absolute");c("#ANNOtype_bubble_moderation").css("top",d.top);c("#ANNOtype_bubble_moderation").css("left",d.left);c("#ANNOtype_bubble_moderation").fadeIn(150);return false});c(".ANNOtype_bubble").find("input[type=text]").live("keypress",function(h){var g=(h.keyCode?h.keyCode:h.which);if(g==13){var f=c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=annotationID]").val();var d=c(this).parents(".ANNOtype_bubble");if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=userID]").length==0){if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()==""||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()=="Name (required)"){alert("Please enter your name to comment.");return false}if((c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()==""||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()=="Email (required, private)")&&c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=emailRequired]").val()=="On"){alert("Please enter your email address in correct format to comment.");return false}}if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val()=="What is on your mind?"||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val()==""){return false}if((typeof(FB)=="object"&&FB._userStatus=="unknown")||c(".ANNOtype_twitter").length==0){c.cookie("anno_name",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val());c.cookie("anno_email",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val());c.cookie("anno_website",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=website]").val());c(".ANNOtype_bubble input[name=name]").attr("value",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val());c(".ANNOtype_bubble input[name=email]").attr("value",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val());c(".ANNOtype_bubble input[name=website]").attr("value",c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=website]").val())}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_addPostComment",ID:f,name:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val(),email:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val(),website:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=website]").val(),comment:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val(),userID:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=userID]").val(),subscribe:c(this).parents(".ANNOtype_bubble").find("input[name=subscribecheck]").is(":checked")},function(e){if(e!=="spam"){c(d).find(".ANNOresponses ul").append(e);c("abbr.timeago").timeago();c(d).find(".ANNOresponses").fadeIn(150);if(c(d).find(".ANNOresponses ul").height()>250){c(d).find(".ANNOresponses").css("overflow-y","scroll").addClass("ANNOresponsesFrame");c(d).find(".ANNOresponses li, .ANNOresponseTitle, .ANNOresponseComment, .ANNOresponseMeta").addClass("ANNOresponseShort")}c.cookie("optin",true,{expires:30})}else{alert("Your comment has been marked as spam.")}c(d).find(".ANNOtype_bubbleRespond textarea").val("What is on your mind?")});if(ANNOVars.collector=="Aweber"&&c(this).parents(".ANNOtype_bubble").find("input[name=subscribecheck]").is(":checked")&&ANNOVars.aweber=="On"&&trim(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()).length>=1&&trim(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()).length>=1){c.post("http://www.aweber.com/scripts/addlead.pl",{listname:ANNOVars.aweberListName,name:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val(),email:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()})}}});var a;rangy.init();var b=0;c(document).mouseup(function(d){if(d.isImmediatePropagationStopped()){return false}if(c(d.target).parents(".ANNOtype_bubble").length==0&&!c(d.target).hasClass("ANNOBubbleCount")){c(".ANNOtype_bubble").fadeOut(150);c("#ANNOScreenOverlay").css("visibility","hidden")}if(c(d.target).parents(".newANNOComment").length==0){c(".newANNOComment").fadeOut(150)}if(c(d.target).parents(".newANNODiscussImg").length==0){c(".newANNODiscussImg").fadeOut(150)}if(c(d.target).parents(".newANNODiscuss").length==0){if(c(".newANNODiscuss").is(":visible")){c(".newANNODiscuss").fadeOut(150)}}if(c(d.target).parents(".ANNOBubbleCount").length==0){c(".ANNOBubbleCount").fadeOut(150)}if(!c(d.target).hasClass("Email")&&c(d.target).parents("#ANNO_emailShare").length==0){if(c("#ANNO_emailShare").is(":visible")){c("#ANNO_emailShare").fadeOut(150)}}var f=c(".ANNOtype_bubble:visible").find("input[name=selectedText]").attr("value");c(".the-content img[src="+f+"]").removeClass("shadow");if(c(".newANNODiscuss").not(":visible").length>=1){c(".newAnnotation").each(function(){c(this).fadeOut(150);c(this).replaceWith(c(this).html())})}});if((ANNOVars.visitorsAnnotate=="Off"&&ANNOVars.userLoggedIn=="On")||ANNOVars.visitorsAnnotate=="On"||ANNOVars.userLoggedIn=="On"){c(".the-content").mouseup(function(l){savedSel=saveSelection();c(".ANNOtype_bubble, .newANNOComment, .newANNODiscussImg").fadeOut(150);var f=rangy.createRange();var d=rangy.getSelection();var k=d.getRangeAt(0);b=b+1;var g=c(d.focusNode).parents(".the-content");var j=c(".annotation");var h=false;c(j).each(function(){var e=c(this).text();if(strpos(d.toString(),e,0)!==false){h=true;return false}});if(h===true){return false}if(g.length>=1){var m=d.toString();if(trim(m).length>0){l.stopImmediatePropagation();c(".newANNODiscuss").css("position","absolute");c(".newANNODiscuss").css("left",l.pageX);c(".newANNODiscuss").css("top",l.pageY+5);c(".newANNODiscuss").fadeIn(150);c(".ANNOtype_newBubble").find("input[name=selectedText]").attr("value",m);c(".ANNOtype_newBubble").find("input[name=subtype]").attr("value","txt");c(".ANNOtype_newBubble").css("position","absolute");c(".ANNOtype_newBubble").css("left",l.pageX-20);c(".ANNOtype_newBubble").css("top",l.pageY+30);c(".newANNODiscuss").attr("id","newAnno_"+b);c(".ANNOtype_newBubble").attr("id","newAnno_"+b+"_bubble")}else{}}})}if((ANNOVars.visitorsAnnotate=="Off"&&ANNOVars.userLoggedIn=="On")||(ANNOVars.visitorsAnnotate=="On"&&ANNOVars.images=="On")){c(".the-content img").mouseenter(function(){if(c(".ANNOtype_bubble:visible").length==0){c(this).addClass("shadow");var f=c(this).offset();var d=c(this).width();var h=c(this).attr("src");c(".newANNOComment, .newANNODiscuss").hide();var g=c(".ANNOtype_bubble input[name=selectedText][value="+h+"]").parents(".ANNOtype_bubble").not(".ANNOtype_newBubble");c(".newANNODiscussImg").css("position","absolute");c(".newANNODiscussImg").css("left",f.left+d-20);c(".newANNODiscussImg").css("top",f.top+10);c(".newANNODiscussImg").attr("id",c(this).attr("src"));c(".newANNODiscussImg").fadeIn(150);var g=c(".ANNOtype_bubble input[name=selectedText][value="+h+"]").parents(".ANNOtype_bubble").not(".ANNOtype_newBubble, ANNOtype_fullBubble");if(g.length>1){g=g[0]}var e=c(g).find(".ANNOresponses li").length;if(c(g).find(".ANNOmainComment").length>=1){var e=c(g).find(".ANNOresponses li").length;c(".newANNODiscussImg").find(".countW").show()}else{c(".newANNODiscussImg").find(".countW").hide()}c(".newANNODiscussImg").find(".count").text(e);c(".ANNOtype_newBubble").find("input[name=selectedText]").attr("value",c(this).attr("src"));c(".ANNOtype_newBubble").find("input[name=subtype]").attr("value","img");return false}}).mouseleave(function(d){if(c(d.relatedTarget).parents(".newANNODiscussImg").length==0){c(".newANNODiscussImg").fadeOut(150)}c(this).removeClass("shadow")});c(".newANNODiscussImg").mouseover(function(){var d=c(this).attr("id");c(".the-content img[src="+d+"]").addClass("shadow")}).mouseout(function(){var d=c(this).attr("id");c(".the-content img[src="+d+"]").removeClass("shadow")});c(".newANNODiscussImg .converseOnly, .newANNODiscussImg .converse").click(function(){c(".ANNOtype_bubble").fadeOut(150);c(this).parents(".newANNODiscussImg").fadeOut(150);c(".newANNOComment, .newANNODiscuss").hide();var g=c(this).parents(".newANNODiscussImg").attr("id");var f=c(".ANNOtype_bubble input[name=selectedText][value="+g+"]").parents(".ANNOtype_bubble").not(".ANNOtype_newBubble, .ANNOtype_fullBubble");if(f.length>1){f=f[0]}if(f.length==0){var e=c(".the-content").find("img[src="+g+"]").offset();var d=c(".the-content img[src="+g+"]").width();c(".ANNOtype_newBubble").css("position","absolute");c(".ANNOtype_newBubble").css("left",e.left+d-20);c(".ANNOtype_newBubble").css("top",e.top+30);c(".ANNOtype_newBubble").fadeIn(150);c(".ANNOtype_newBubble").find("textarea").focus()}else{var e=c(".the-content").find("img[src="+g+"]").offset();var d=c(".the-content img[src="+g+"]").width();c(f).css("position","absolute");c(f).css("left",e.left+d-20);c(f).css("top",e.top+30);c(f).fadeIn(150)}return false});c(".ANNOtype_bubble").mouseover(function(){var d=c(this).find("input[name=selectedText]").attr("value");c(".the-content img[src="+d+"]").addClass("shadow")})}c(".newANNODiscuss").live("mouseenter",function(){var d=rangy.getSelection();var h=d.getRangeAt(0);if(h.startOffset>=1){var e=0;while(true){var h=d.getRangeAt(0);var g=d.toString();if(g.substr(0,1)!=" "&&g.substr(0,1)!=","&&g.substr(0,1)!="."){h.setStart(h.startContainer,h.startOffset-1);d.removeAllRanges();d.addRange(h)}else{h.setStart(h.startContainer,h.startOffset+1);d.removeAllRanges();d.addRange(h);break}e++}}var f=0;while(true){var h=d.getRangeAt(0);var g=d.toString();if(g.substr(-1)!=" "&&g.substr(-1)!=","&&g.substr(-1)!="."){h.setEnd(h.endContainer,h.endOffset+1);d.removeAllRanges();d.addRange(h)}else{h.setEnd(h.endContainer,h.endOffset-1);d.removeAllRanges();d.addRange(h);break}f++}var g=d.toString();c(".ANNOtype_newBubble").find("input[name=selectedText]").attr("value",g)});c(".newANNODiscuss").live("mouseleave",function(){if(!c(".ANNOtype_newBubble").is(":visible")){restoreSelection(savedSel)}});c(".newANNODiscuss .converseOnly, .newANNODiscuss .converse").live("click",function(){c(".ANNOtype_bubble").fadeOut(150);c(".newANNODiscuss").fadeOut(150);c(".newANNOComment, .newANNODiscussImg").hide();var f=c(this).parents(".newANNODiscuss").attr("id");var e=c(".the-content #"+f).offset();var d=c("#"+f).width();c("#"+f+"_bubble").fadeIn(150);return false});c(".newANNODiscuss .share").click(function(d){d.preventDefault()});c(".newANNODiscuss .share").live("hover",function(d){d.preventDefault();if(!c(".newANNODiscuss .shareBar").is(":visible")){c(".newANNODiscuss .shareBar").show("slide",{direction:"left"},150)}}).mouseout(function(d){if(c(".newANNODiscuss .shareBar").is(":visible")&&c(d.relatedTarget).hasClass("shareBar")==false){c(".newANNODiscuss .shareBar").delay(1000).hide("slide",{direction:"left"},150)}});c(".newANNOComment .share").live("hover",function(d){d.preventDefault();if(!c(".newANNOComment .shareBar").is(":visible")){c(".newANNOComment .shareBar").show("slide",{direction:"left"},150)}}).mouseout(function(d){if(c(".newANNOComment .shareBar").is(":visible")&&c(d.relatedTarget).hasClass("shareBar")==false){c(".newANNOComment .shareBar").delay(1000).hide("slide",{direction:"left"},150)}});c(".newANNODiscussImg .share").live("hover",function(d){d.preventDefault();if(!c(".newANNODiscussImg .shareBar").is(":visible")){c(".newANNODiscussImg .shareBar").show("slide",{direction:"left"},150)}}).mouseout(function(d){if(c(".newANNODiscussImg .shareBar").is(":visible")&&c(d.relatedTarget).hasClass("shareBar")==false){c(".newANNODiscussImg .shareBar").delay(1000).hide("slide",{direction:"left"},150)}});c(".newANNODiscuss .shareBar .FB").live("click",function(h){h.preventDefault();var g=rangy.createRange();var d=rangy.getSelection();var j=d.toString();var f=window.location.href.replace("#","");window.open("http://www.facebook.com/sharer.php?u="+f+"&t="+j,"Sharing to Facebook","width=500, height=500");c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:j,type:"facebook"},function(e){})});c(".newANNOComment .shareBar .FB").live("click",function(f){f.preventDefault();var h=c(this).parents(".newANNOComment").attr("id");var g=c(".the-content").find("#"+h).eq(0).text();var d=window.location.href.replace("#","");window.open("http://www.facebook.com/sharer.php?u="+d+"&t="+g,"Sharing to Facebook","width=500, height=500");c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:g,type:"facebook"},function(e){})});c(".newANNODiscussImg .shareBar .FB").live("click",function(f){f.preventDefault();var g=c(this).parents(".newANNODiscussImg").attr("id");var d=window.location.href.replace("#","");window.open("http://www.facebook.com/sharer.php?u="+d+"&t="+g,"Sharing to Facebook","width=500, height=500");c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:g,type:"facebook"},function(e){})});c(".newANNODiscuss .shareBar .Twitter").live("click",function(h){h.preventDefault();var g=rangy.createRange();var d=rangy.getSelection();var j=d.toString();var j=j.substr(0,120);var f=window.location.href.replace("#","");window.open("http://twitter.com/share?url="+f+"&text="+j,"Sharing to Twitter","width=500, height=500");var j=d.toString();c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:j,type:"twitter"},function(e){})});c(".newANNOComment .shareBar .Twitter").live("click",function(f){f.preventDefault();var h=c(this).parents(".newANNOComment").attr("id");var g=c(".the-content").find("#"+h).eq(0).text().substr(0,120);var d=window.location.href.replace("#","");window.open("http://twitter.com/share?url="+d+"&text="+g,"Sharing to Twitter","width=500, height=500");var g=c(".the-content").find("#"+h).eq(0).text();c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:g,type:"twitter"},function(e){})});c(".newANNODiscussImg .shareBar .Twitter").live("click",function(f){f.preventDefault();var g=c(this).parents(".newANNODiscussImg").attr("id");var d=window.location.href.replace("#","");window.open("http://twitter.com/share?url="+d+"&text="+g,"Sharing to Twitter","width=500, height=500");c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:g,type:"twitter"},function(e){})});jQuery.fn.center=function(){this.css("position","absolute");this.css("top",(c(window).height()-this.height())/2+c(window).scrollTop()+"px");this.css("left",(c(window).width()-this.width())/2+c(window).scrollLeft()+"px");return this};c(".newANNODiscuss .shareBar .Email").live("click",function(h){h.preventDefault();var f=rangy.createRange();var d=rangy.getSelection();var j=d.toString();var g=c("#ANNO_emailShare").find("textarea").attr("value");g=g.replace("{post name}",'<a href="'+ANNOVars.post_permalink+'">'+ANNOVars.post_title+"</a>");g=g.replace("{website_name}",'<a href="'+ANNOVars.blogurl+'">'+ANNOVars.blogname+"</a>");g=g.replace("{my highlighted text}",j);c("#ANNO_emailShare").find("textarea").attr("value",g);c("#ANNO_emailShare").css("position","absolute");c("#ANNO_emailShare").css("top",(c(window).height()-c("#ANNO_emailShare").height())/2+c(window).scrollTop()+"px");c("#ANNO_emailShare").css("left",(c(window).width()-c("#ANNO_emailShare").width())/2+c(window).scrollLeft()+"px");c("#ANNO_emailShare").show();c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:j,type:"email"},function(e){})});c(".newANNOComment .shareBar .Email").live("click",function(f){f.preventDefault();var h=c(this).parents(".newANNOComment").attr("id");var g=c(".the-content").find("#"+h).eq(0).text();var d=c("#ANNO_emailShare").find("textarea").attr("value");d=d.replace("{post name}",'<a href="'+ANNOVars.post_permalink+'">'+ANNOVars.post_title+"</a>");d=d.replace("{website_name}",'<a href="'+ANNOVars.blogurl+'">'+ANNOVars.blogname+"</a>");d=d.replace("{my highlighted text}",g);c("#ANNO_emailShare").find("textarea").attr("value",d);c("#ANNO_emailShare").css("position","absolute");c("#ANNO_emailShare").css("top",(c(window).height()-c("#ANNO_emailShare").height())/2+c(window).scrollTop()+"px");c("#ANNO_emailShare").css("left",(c(window).width()-c("#ANNO_emailShare").width())/2+c(window).scrollLeft()+"px");c("#ANNO_emailShare").show();c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:g,type:"email"},function(e){})});c(".newANNODiscussImg .shareBar .Email").live("click",function(f){f.preventDefault();var g=c(this).parents(".newANNODiscussImg").attr("id");var d=c("#ANNO_emailShare").find("textarea").attr("value");d=d.replace("{post name}",'<a href="'+ANNOVars.post_permalink+'">'+ANNOVars.post_title+"</a>");d=d.replace("{website_name}",'<a href="'+ANNOVars.blogurl+'">'+ANNOVars.blogname+"</a>");d=d.replace("{my highlighted text}",g);c("#ANNO_emailShare").find("textarea").attr("value",d);c("#ANNO_emailShare").css("position","absolute");c("#ANNO_emailShare").css("top",(c(window).height()-c("#ANNO_emailShare").height())/2+c(window).scrollTop()+"px");c("#ANNO_emailShare").css("left",(c(window).width()-c("#ANNO_emailShare").width())/2+c(window).scrollLeft()+"px");c("#ANNO_emailShare").show();c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_trackHighlight",highlight:g,type:"email"},function(e){})});c("#ANNO_emailShare .close").click(function(d){d.preventDefault();c("#ANNO_emailShare").fadeOut()});c("#ANNO_emailShare .submit").click(function(d){d.preventDefault();c("#ANNO_emailShare form").trigger("submit")});c("#ANNO_emailShare form").submit(function(j){j.preventDefault();var d=c(this).find("input[name=yourName]").attr("value");var g=c(this).find("input[name=yourEmail]").attr("value");var h=c(this).find("input[name=friendName]").attr("value");var f=c(this).find("input[name=friendEmail]").attr("value");var k=c(this).find("textarea[name=comment]").text();if(d=="Your Name"||d==""){alert("Please enter your name.");return false}if(g=="Your Email"||g==""){alert("Please enter your email address.");return false}if(h=="Friend's Name"||h==""){alert("Please enter your friend's name.");return false}if(f=="Friend's Email"||f==""){alert("Please enter your friend's email address.");return false}if(trim(k)==""){alert("Please enter a message.");return false}c.post(ANNOVars.ajaxUrl,c(this).serialize(),function(e){c("#ANNO_emailShare").fadeOut()})});c(".discussAnnotation").live("click",function(){var e=c(this).parents(".ANNOtype_bubble").attr("id");if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond input[name=userID]").length==0){if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()==""||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()=="Name (required)"){alert("Your name is required.");c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").addClass("error").focus();return false}else{c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").removeClass("error")}if((c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()==""||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()=="Email (required, private)")&&c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=emailRequired]").val()=="On"){alert("Your email is required.");c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").addClass("error").focus();return false}else{c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").removeClass("error")}}if(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val()=="What is on your mind?"||c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").val()==""){alert("Please enter a comment");c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").addClass("error").focus();return false}else{c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleRespond textarea").removeClass("error").focus()}if(c(this).parents(".ANNOtype_bubble").find("input[name=subscribecheck]").is(":checked")&&ANNOVars.aweber=="On"&&trim(c("#"+e+" input[name=name]").val()).length>=1&&trim(c("#"+e+" input[name=email]").val()).length>=1){c.post("http://www.aweber.com/scripts/addlead.pl",{listname:ANNOVars.aweberListName,name:c("#"+e+" input[name=name]").val(),email:c("#"+e+" input[name=email]").val()})}if((typeof(FB)=="object"&&FB._userStatus=="unknown")||c(".ANNOtype_twitter").length==0){c.cookie("anno_name",c("#"+e+" input[name=name]").val());c.cookie("anno_email",c("#"+e+" input[name=email]").val());c.cookie("anno_website",c("#"+e+" input[name=website]").val())}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_addNewAnnotation",postID:ANNOVars.postID,selectText:c("#"+e+" input[name=selectedText]").val(),name:c("#"+e+" input[name=name]").val(),email:c("#"+e+" input[name=email]").val(),website:c("#"+e+" input[name=website]").val(),comment:c("#"+e+" textarea").val(),userID:c("#"+e+" input[name=userID]").val(),subtype:c("#"+e+" input[name=subtype]").val(),subscribe:c("#"+e).find("input[name=subscribecheck]").is(":checked")},function(f){c.cookie("optin",true,{expires:30})});var d=c(c(this).parents(".ANNOtype_bubble")).position();c(c(this).parents(".ANNOtype_bubble")).fadeOut(150);c("#ANNOtype_bubble_moderation").css("position","absolute");c("#ANNOtype_bubble_moderation").css("top",d.top);c("#ANNOtype_bubble_moderation").css("left",d.left);c("#ANNOtype_bubble_moderation").fadeIn(150);return false});c(".closeAnnotation").live("click",function(){var d=c(".newAnnotation").html();c(".newAnnotation").after(d);c(".newAnnotation").remove();c("#ANNOtype_bubble").fadeOut(150);return false});c("input[type=checkbox][name=effects], input[type=checkbox][name=annoboxtoggle]").click(function(){if(c(this).attr("value")=="On"){if(c(this).is(":checked")){c(".annotation").css("background-color","#"+ANNOVars.highlightColor)}else{c(".annotation").css("background-color","transparent")}}else{if(c(this).is(":checked")){c(".annotation").css("background-color","transparent")}else{c(".annotation").css("background-color","#"+ANNOVars.highlightColor)}}});if(ANNOVars.highlight=="On"){c(".annotation").css("background-color","#"+ANNOVars.highlightColor)}if(ANNOVars.underline=="Off"){c(".annotation").css("border-bottom","0")}c(".ANNOtype_bubble .mainAnnoActualComment a, .ANNOtype_bubble .ANNOComment a").css("color","#"+ANNOVars.bubbleLinkColor);c(window).scroll(function(d){if(c(window).scrollTop()==0){c(".ANNOTopBar").fadeOut()}else{if(c.cookie("topBar")){if(c.cookie("topBar")!="close"){c(".ANNOTopBar").fadeIn()}}else{c(".ANNOTopBar").fadeIn()}}});c(".ANNOTopBar .close").click(function(){c(".ANNOTopBar").fadeOut();c.cookie("topBar","close");return false});c(".ANNOtype_bubble .help, #smallformtxt").tipTip({attribute:"href"});c("#ANNOtype_facebookConnect, .annoboxfb").click(function(d){d.preventDefault();FB.login()});c(".ANNOtype_bubble .closeBubble").click(function(d){d.preventDefault();c(this).parents(".ANNOtype_bubble").fadeOut("fast");c("#ANNOScreenOverlay").css("visibility","hidden")});c(".ANNOmainComment .unlike").live("click",function(j){j.preventDefault();var l=c(this).parents(".ANNOmainComment").attr("id");var d=l.replace("ANNOComment_","");var k=c(this).parents(".ANNOmainComment");var g=c(this);var f=c(k).find(".likes").text();var h=parseInt(f)-1;c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_likes",id:d,status:"unlike"},function(e){c(k).find(".likes").text(h);c.cookie("ANNOCommentID_"+d,"unlike",{expires:30});c(g).hide();c(k).find("a.like").show();if(h!=0){c(k).find(".count").show()}else{c(k).find(".count").hide()}})});c(".ANNOmainComment .like").live("click",function(j){j.preventDefault();var l=c(this).parents(".ANNOmainComment").attr("id");var d=l.replace("ANNOComment_","");var k=c(this).parents(".ANNOmainComment");var g=c(this);var f=c(k).find(".likes").text();var h=parseInt(f)+1;c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_likes",id:d,status:"like"},function(e){c(k).find(".likes").text(h);c.cookie("ANNOCommentID_"+d,"like",{expires:30});c(g).hide();c(k).find("a.unlike").show();c(k).find(".count").show()})});c(".ANNOresponses .unlike").live("click",function(j){j.preventDefault();var l=c(this).parents("li").attr("id");var d=l.replace("ANNOComment_","");var k=c(this).parents("li");var g=c(this);var f=c(k).find(".likes").text();var h=parseInt(f)-1;c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_likes",id:d,status:"unlike"},function(e){c(k).find(".likes").text(h);c.cookie("ANNOCommentID_"+d,"unlike",{expires:30});c(g).hide();c(k).find("a.like").show();if(h!=0){c(k).find(".count").show()}else{c(k).find(".count").hide()}})});c(".ANNOresponses .like").live("click",function(j){j.preventDefault();var l=c(this).parents("li").attr("id");var d=l.replace("ANNOComment_","");var k=c(this).parents("li");var g=c(this);var f=c(k).find(".likes").text();var h=parseInt(f)+1;c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_likes",id:d,status:"like"},function(e){c(k).find(".likes").text(h);c.cookie("ANNOCommentID_"+d,"like",{expires:30});c(g).hide();c(k).find("a.unlike").show();c(k).find(".count").show()})});c(".ANNOtype_bubble .ANNOresponses li").mouseover(function(){c(this).find(".ANNOresponseTitleAdmin").fadeIn("fast")}).mouseleave(function(){c(this).find(".ANNOresponseTitleAdmin").fadeOut("fast")});c(".annoboxresponseblue, .annoboxresponsedarkgray, .annoboxresponselightgray").slice(0,5).show();c(".annoboxresponseblue, .annoboxresponsedarkgray").click(function(d){d.preventDefault();c(this).toggleClass("annoboxresponseblue");c(this).toggleClass("annoboxresponsedarkgray");c(this).next().slideToggle("200")});c(".annoboxresponseblue, .annoboxresponselightgray").click(function(d){d.preventDefault();c(this).toggleClass("annoboxresponseblue");c(this).toggleClass("annoboxresponselightgray");c(this).next().slideToggle("200")});c(".annoboxrssbar .annoboxbigbubble").click(function(d){d.preventDefault();c("#annobox .annoboxresponseindent").slideToggle("200")});c(".annoboxMore").click(function(d){d.preventDefault();if(c(".annoboxresponseblue, .annoboxresponsedarkgray, .annoboxresponselightgray").filter(":hidden").length>=1){for(i=1;i<=5;i++){c(".annoboxresponseblue, .annoboxresponsedarkgray, .annoboxresponselightgray").filter(":hidden").slice(0,5).show()}}var f=c(".annoboxresponseblue, .annoboxresponsedarkgray, .annoboxresponselightgray").filter(":visible").length;c("#annobox .current").text(f)});c(".annoboxsmallrespondtop").mouseover(function(){c(this).find(".annoboxadmin").fadeIn()}).mouseout(function(){c(this).find(".annoboxadmin").fadeOut()});c(".annoboxform form").submit(function(f){f.preventDefault();var d=c(this).attr("class").replace("annotationID_","");if(c(this).find("input[name=userID]").length==0){if(c(this).find("input[name=name]").val()==""||c(this).find("input[name=name]").val()=="Name (required)"){alert("Please enter your name to comment on this annotation.");return false}if((c(this).find("input[name=email]").val()==""||c(this).find("input[name=email]").val()=="Email (required, private)")&&c(this).find("input[name=emailRequired]").val()=="On"){alert("Please enter your email address in correct format to comment on this annotation.");return false}}if(c(this).find("textarea[name=comment]").val()=="What is on your mind?"||c(this).find("textarea[name=comment]").val()==""){alert("Please enter a comment for this annotation.");return false}c.post(ANNOVars.ajaxUrl,{action:"ANNOtype_addPostComment",ID:d,name:c(this).find("input[name=name]").val(),email:c(this).find("input[name=email]").val(),website:c(this).find("input[name=website]").val(),comment:c(this).find("textarea[name=comment]").val(),userID:c(this).find("input[name=userID]").val(),subscribe:c(this).find("input[name=subscribecheck]").val()},function(e){if(e=="spam"){alert("Your comment has been marked as spam.")}c.cookie("optin",true,{expires:30});window.location=""});if(c(this).find("input[name=subscribecheck]").is(":checked")&&ANNOVars.aweber=="On"&&trim(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val()).length>=1&&trim(c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()).length>=1){c.post("http://www.aweber.com/scripts/addlead.pl",{listname:ANNOVars.aweberListName,name:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=name]").val(),email:c(this).parents(".ANNOtype_bubble").find(".ANNOtype_bubbleText input[name=email]").val()})}});c(".ANNOtype_bubbleSorting a").live("click",function(o){o.preventDefault();var d=c(this).attr("href").replace("#","");var q=c(this).parents(".ANNOtype_bubble");var n=c(q).find(".ANNOresponses li").get();if(d=="newest"){n.sort(function(t,e){var t=c(t).data("date");var e=c(e).data("date");return e-t})}else{if(d=="oldest"){n.sort(function(t,e){var t=c(t).data("date");var e=c(e).data("date");return t-e})}else{if(d=="rating"){n.sort(function(t,e){var t=c(t).data("likes");var e=c(e).data("likes");return e-t})}}}var p=c(q).find(".ANNOresponses ul");c.each(n,function(t,e){p.append(e)});c(q).find(".ANNOresponses ul li").show();c(q).find(".ANNOresponses ul li").eq(0).hide();var s=c(q).find(".ANNOresponses ul li").eq(0);var j=c(q).find(".ANNOmainComment");var l=c(s).find(".name").html();var r=c(s).find(".ANNOresponseTitleDetails img").attr("src");var f=c(s).attr("id");var m=c(s).find(".ANNOresponseComment").html();var h=c(s).find(".timeago").html();var g=c(s).find(".timeago").attr("title");var k=c(s).find(".ANNOresponseAction").html();c(j).find(".name").html(l);c(j).find(".ANNOmainCommentTitleDetails img").attr("src",r);c(j).attr("id",f);c(j).find(".ANNOmainCommentComment").html(m);c(j).find(".timeago").html(h);c(j).find(".timeago").attr("title",g);c(j).find(".ANNOmainCommentLike").html(k)});c(".expandBubble").live("click",function(d){d.preventDefault();var f=c(this).parents(".ANNOtype_bubble").attr("id").replace("ANNOtype_bubble_").replace("ANNOtype_bubble_").replace("undefined","");c(this).parents(".ANNOtype_bubble").fadeOut(150);c("#ANNOtype_fullBubble_"+f).css("position","absolute");c("#ANNOtype_fullBubble_"+f).css("top",(c(window).height()-c("#ANNOtype_fullBubble_"+f).height())/2+c(window).scrollTop()+"px");c("#ANNOtype_fullBubble_"+f).css("left",(c(window).width()-c("#ANNOtype_fullBubble_"+f).width())/2+c(window).scrollLeft()+"px");c("#ANNOScreenOverlay").height(c(document).height());c("#ANNOScreenOverlay").css("visibility","visible");c("#ANNOtype_fullBubble_"+f).fadeIn(150);if(c("#ANNOtype_fullBubble_"+f).find(".ANNOresponses ul").height()>250){c("#ANNOtype_fullBubble_"+f).find(".ANNOresponses").css("overflow-y","scroll").addClass("ANNOresponsesFrame");c("#ANNOtype_fullBubble_"+f).find(".ANNOresponses li, .ANNOresponseTitle, .ANNOresponseComment, .ANNOresponseMeta").addClass("ANNOresponseShort")}})});function trim(e,d){var b,a=0,c=0;e+="";if(!d){b=" \n\r\t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000"}else{d+="";b=d.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1")}a=e.length;for(c=0;c<a;c++){if(b.indexOf(e.charAt(c))===-1){e=e.substring(c);break}}a=e.length;for(c=a-1;c>=0;c--){if(b.indexOf(e.charAt(c))===-1){e=e.substring(0,c+1);break}}return b.indexOf(e.charAt(0))===-1?e:""}var saveSelection,restoreSelection;if(window.getSelection){saveSelection=function(){var d=window.getSelection(),b=[];if(d.rangeCount){for(var c=0,a=d.rangeCount;c<a;++c){b.push(d.getRangeAt(0))}}return b};restoreSelection=function(b){var d=window.getSelection();d.removeAllRanges();for(var c=0,a=b.length;c<a;++c){d.addRange(b[c])}}}else{if(document.selection&&document.selection.createRange){saveSelection=function(){var a=document.selection;return(a.type!="None")?a.createRange():null};restoreSelection=function(a){if(a){a.select()}}}}function strpos(b,c,d){var a=(b+"").indexOf(c,(d||0));return a===-1?false:a};